name: Issue Management

on:
  workflow_call:

env:
  PROJECT_ID: 1
  TRIAGE_LABEL: needs-triage

jobs:
  manage_incoming_issues:
    name: Manage incoming issues
    if: ${{ github.event.action == 'opened' || github.event.action == 'reopened' }}
    runs-on: ubuntu-latest
    concurrency: issue_labels-${{ github.event.issue.number }}
    permissions:
      issues: write
    steps:
        - run: |
            # make sure that label exists
            gh label --repo ${{ github.event.issue.organization }}/${{ github.event.issue.repo }} create -f ${{ env.TRIAGE_LABEL }} -c 000000 -d "Issue needs triage"
            # add label to issue
            gh issue --repo ${{ github.event.issue.organization }}/${{ github.event.issue.repo }} edit $ISSUE --add-label ${{ env.TRIAGE_LABEL }}
            # add issue to the project 
            gh project item-add ${{ env.PROJECT_ID }} --owner ${{ github.event.issue.organization }} --url $ISSUE 
          env:
            GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
            ISSUE: ${{ github.event.issue.html_url }}
